#include <errno.h>
#include "exploit.h"

int overflow(const char *str)
{
    int fd = creat("output.txt", S_IRWXU);
    char buffer[128]; //< buffer vulnerabile

    if (fd == -1)
    {
        write(2, strerror(errno), 28);
        write(2, "\n", 1);
        return EXIT_FAILURE;
    }
    if (str == NULL)
    { //< evita che il programma termini per lettura di un valore nullo
        write(2,  "Error: not to write ...\n", 25);
        return EXIT_FAILURE;
    }

    printf("Overflow(): str= %s\n", str);
    strcat(buffer, str); //< vulnerabilita' del codice
    printf("Overflow(): buffer= %s\n", buffer);

    if (write(fd, buffer, strlen(str)) == -1)
    {
        write(2, "Error: I/O error ...\n", 22);
        return EXIT_FAILURE;
    }

    return EXIT_SUCCESS;
}
